<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>BSP430: utility/m25p/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20141115</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">utility/m25p/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html">bsp430/platform.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clock_8h.html">bsp430/clock.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="uptime_8h.html">bsp430/utility/uptime.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="console_8h.html">bsp430/utility/console.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="m25p_8h.html">bsp430/utility/m25p.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef WITH_W25Q80BV</span></div>
<div class="line"><span class="preprocessor">#define WITH_W25Q80BV (BSP430_PLATFORM_EXP430F5529LP - 0)</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* WITH_W25Q80BV */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (WITH_W25Q80BV - 0)</span></div>
<div class="line"><span class="comment">/* Winbond W25Q80BV is a 8 Mibit (1 MiBy) serial FLASH supporting 256</span></div>
<div class="line"><span class="comment"> * 4 KiBy sub-sectors (sectors) or 16 64 KiBy sectors (blocks).  PAGE</span></div>
<div class="line"><span class="comment"> * WRITE and PAGE ERASE are not supported; (SUB) SECTOR ERASE is</span></div>
<div class="line"><span class="comment"> * supported. */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_M25P_SUPPORTS_SSE 1</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_M25P_SECTOR_COUNT 16</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_M25P_SECTOR_SIZE 0x10000</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_M25P_SUBSECTOR_SIZE 0x1000</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (BSP430_PLATFORM_EXP430F5529LP - 0)</span></div>
<div class="line"><span class="comment">/* SPI on USCI_A0, CSn on P6.6, PWR and RSTn hard-wired */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_M25P_CSn_PORT_PERIPH_HANDLE BSP430_PERIPH_PORT6</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_M25P_CSn_PORT_BIT BIT6</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* WITH_W25Q80BV */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* As-delivered TrxEB flash is completely erased except for the first</span></div>
<div class="line"><span class="comment"> * sixteen bytes which have this useful test pattern. */</span></div>
<div class="line"><span class="keyword">const</span> uint8_t flashContents[] = {</div>
<div class="line">  0xAA, 0x55, 0x0F, 0xF0, 0xCC, 0x33, 0xC3, 0x3C,</div>
<div class="line">  0x01, 0x23, 0x45, 0x67, 0x89, 0xAB, 0xCD, 0xEF</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">uint8_t buffer[256];</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> readFromAddress (<a name="_a0"></a><a class="code" href="structsBSP430m25p.html">hBSP430m25p</a> m25p,</div>
<div class="line">                     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr,</div>
<div class="line">                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rc = -1;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> (len &gt; <span class="keyword">sizeof</span>(buffer)) {</div>
<div class="line">    len = <span class="keyword">sizeof</span>(buffer);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == <a name="a1"></a><a class="code" href="m25p_8h.html#a9e8858d2fbda9aa756c1e76bc153221e">iBSP430m25pInitiateAddressCommand_rh</a>(m25p, <a name="a2"></a><a class="code" href="m25p_8h.html#af15e5e09fa54bb2f2b038399575f686e">BSP430_M25P_CMD_FAST_READ</a>, addr)) {</div>
<div class="line">    rc = <a name="a3"></a><a class="code" href="m25p_8h.html#a22dde58e3aa1f17de5d0b1eea846fc01">iBSP430m25pCompleteTxRx_rh</a>(m25p, NULL, 0, len, buffer);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> rc;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> writeToAddress (<a class="code" href="structsBSP430m25p.html">hBSP430m25p</a> m25p,</div>
<div class="line">                    uint8_t cmd,</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr,</div>
<div class="line">                    <span class="keyword">const</span> uint8_t * data,</div>
<div class="line">                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t1;</div>
<div class="line">  <span class="keywordtype">int</span> rc;</div>
<div class="line">  <span class="keywordtype">int</span> sr;</div>
<div class="line"></div>
<div class="line">  rc = <a name="a4"></a><a class="code" href="m25p_8h.html#a46ce5ccee68da4793921a40270d18256">iBSP430m25pStrobeCommand_rh</a>(m25p, <a name="a5"></a><a class="code" href="m25p_8h.html#ae31b093e1d07520c8ee4a484ed3410a5">BSP430_M25P_CMD_WREN</a>);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    rc = <a class="code" href="m25p_8h.html#a9e8858d2fbda9aa756c1e76bc153221e">iBSP430m25pInitiateAddressCommand_rh</a>(m25p, cmd, addr);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    rc = <a class="code" href="m25p_8h.html#a22dde58e3aa1f17de5d0b1eea846fc01">iBSP430m25pCompleteTxRx_rh</a>(m25p, data, len, 0, NULL);</div>
<div class="line">  }</div>
<div class="line">  t0 = <a name="a6"></a><a class="code" href="uptime_8h.html#a7e0b8aeba63d7b2ce965a650125eb8ef">ulBSP430uptime</a>();</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    sr = <a name="a7"></a><a class="code" href="m25p_8h.html#a368f87b04450ebeed54eb0ef8bb160c8">iBSP430m25pStatus</a>(m25p);</div>
<div class="line">  } <span class="keywordflow">while</span> ((0 &lt;= sr) &amp;&amp; (<a name="a8"></a><a class="code" href="m25p_8h.html#ab7d0f64136a76d1e261d09d8c7bebb78">BSP430_M25P_SR_WIP</a> &amp; sr));</div>
<div class="line">  t1 = <a class="code" href="uptime_8h.html#a7e0b8aeba63d7b2ce965a650125eb8ef">ulBSP430uptime</a>();</div>
<div class="line">  <a name="a9"></a><a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Write %d took %lu\n&quot;</span>, len, t1 - t0);</div>
<div class="line">  <span class="keywordflow">return</span> rc;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main ()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rc;</div>
<div class="line">  <a class="code" href="structsBSP430m25p.html">sBSP430m25p</a> m25p_data;</div>
<div class="line">  <a class="code" href="structsBSP430m25p.html">hBSP430m25p</a> m25p;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t1;</div>
<div class="line"></div>
<div class="line">  <a name="a10"></a><a class="code" href="platform_8h.html#a616515ce5e0f7635ca36a815841d2a21">vBSP430platformInitialize_ni</a>();</div>
<div class="line">  (void)<a name="a11"></a><a class="code" href="console_8h.html#a91f5f68fa2ee29ca39bf9a23ea98cbe1">iBSP430consoleInitialize</a>();</div>
<div class="line">  <a name="a12"></a><a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line">  <a name="a13"></a><a class="code" href="core_8h.html#a3124959aa09ef7d745fb63c9ff5ee897">BSP430_CORE_DELAY_CYCLES</a>(100 * (<a name="a14"></a><a class="code" href="clock_8h.html#a6ffd3f4fab35b64d0e8ff8d3179d69d9">BSP430_CLOCK_NOMINAL_MCLK_HZ</a> / 1000));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\nBuild &quot;</span> __DATE__ <span class="stringliteral">&quot; &quot;</span> __TIME__ <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;SPI is %s: %s\n&quot;</span>,</div>
<div class="line">          <a name="a15"></a><a class="code" href="serial_8h.html#a7f2e6f39abd1faca343663917e34840a">xBSP430serialName</a>(<a name="a16"></a><a class="code" href="m25p_8h.html#ad31f556b44c44325bcb36f1a62365901">BSP430_PLATFORM_M25P_SPI_PERIPH_HANDLE</a>),</div>
<div class="line">          <a name="a17"></a><a class="code" href="platform_8h.html#ad5df0a450196592bc395c5efe89a6fb3">xBSP430platformPeripheralHelp</a>(<a class="code" href="m25p_8h.html#ad31f556b44c44325bcb36f1a62365901">BSP430_PLATFORM_M25P_SPI_PERIPH_HANDLE</a>, 0));</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PWR at %s.%u\n&quot;</span>,</div>
<div class="line">          <a name="a18"></a><a class="code" href="port_8h.html#a78a791b05b428f3aa2bf5ff09e907200">xBSP430portName</a>(<a name="a19"></a><a class="code" href="m25p_8h.html#ac59877ffa22ab02d6a10d63241909bd0">BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE</a>),</div>
<div class="line">          <a name="a20"></a><a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(<a name="a21"></a><a class="code" href="m25p_8h.html#a02937258e25a670e99f1ad3e5bdaf2ef">BSP430_PLATFORM_M25P_PWR_PORT_BIT</a>));</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PWR is hard-wired\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;RSTn at %s.%u\n&quot;</span>,</div>
<div class="line">          <a class="code" href="port_8h.html#a78a791b05b428f3aa2bf5ff09e907200">xBSP430portName</a>(<a name="a22"></a><a class="code" href="m25p_8h.html#a3b6cc8cae88d0a056fd2fca2a698792c">BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE</a>),</div>
<div class="line">          <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(<a name="a23"></a><a class="code" href="m25p_8h.html#a3dd964d91f5bce099773e2329ea92bd0">BSP430_PLATFORM_M25P_RSTn_PORT_BIT</a>));</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;RSTn is hard-wired\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;CSn at %s.%u\n&quot;</span>,</div>
<div class="line">          <a class="code" href="port_8h.html#a78a791b05b428f3aa2bf5ff09e907200">xBSP430portName</a>(<a name="a24"></a><a class="code" href="m25p_8h.html#a094b725094b1578e9b87697ef1e730ed">BSP430_PLATFORM_M25P_CSn_PORT_PERIPH_HANDLE</a>),</div>
<div class="line">          <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(<a name="a25"></a><a class="code" href="m25p_8h.html#ac0d4d6e663549eb8cf3f171de1263b65">BSP430_PLATFORM_M25P_CSn_PORT_BIT</a>));</div>
<div class="line"></div>
<div class="line">  memset(&amp;m25p_data, 0, <span class="keyword">sizeof</span>(m25p_data));</div>
<div class="line">  m25p_data.<a name="a26"></a><a class="code" href="structsBSP430m25p.html#af3dd901691c0d55f8e385950129dea35">spi</a> = <a name="a27"></a><a class="code" href="serial_8h.html#ad311104b2da6d177b2ae5ec0b29e7207">hBSP430serialLookup</a>(<a class="code" href="m25p_8h.html#ad31f556b44c44325bcb36f1a62365901">BSP430_PLATFORM_M25P_SPI_PERIPH_HANDLE</a>);</div>
<div class="line">  m25p_data.<a name="a28"></a><a class="code" href="structsBSP430m25p.html#a490fe8d3a6e22a6891ece78e1a820354">csn_port</a> = <a name="a29"></a><a class="code" href="port_8h.html#af85295c41d6419afb9df641ae90d0213">xBSP430hplLookupPORT</a>(<a class="code" href="m25p_8h.html#a094b725094b1578e9b87697ef1e730ed">BSP430_PLATFORM_M25P_CSn_PORT_PERIPH_HANDLE</a>);</div>
<div class="line">  m25p_data.<a name="a30"></a><a class="code" href="structsBSP430m25p.html#ae9cbd718d8ab3dade6d843b244b9bce4">csn_bit</a> = <a class="code" href="m25p_8h.html#ac0d4d6e663549eb8cf3f171de1263b65">BSP430_PLATFORM_M25P_CSn_PORT_BIT</a>;</div>
<div class="line"><span class="preprocessor">#ifdef BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE</span></div>
<div class="line">  m25p_data.<a name="a31"></a><a class="code" href="structsBSP430m25p.html#adf4208722ba00a5ac20334d5826927ea">rstn_port</a> = <a class="code" href="port_8h.html#af85295c41d6419afb9df641ae90d0213">xBSP430hplLookupPORT</a>(<a class="code" href="m25p_8h.html#a3b6cc8cae88d0a056fd2fca2a698792c">BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE</a>);</div>
<div class="line">  m25p_data.<a name="a32"></a><a class="code" href="structsBSP430m25p.html#ae39fcb399d621f13a9bf42f1f7223454">rstn_bit</a> = <a class="code" href="m25p_8h.html#a3dd964d91f5bce099773e2329ea92bd0">BSP430_PLATFORM_M25P_RSTn_PORT_BIT</a>;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_M25P_RSTn_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">  m25p = <a name="a33"></a><a class="code" href="m25p_8h.html#aab6ec23e2353d943d94565d23d28d8da">hBSP430m25pInitialize</a>(&amp;m25p_data,</div>
<div class="line">                               <a name="a34"></a><a class="code" href="m25p_8h.html#ac87ab8c022fdf8c869274c91136bb392">BSP430_PLATFORM_M25P_SPI_CTL0_BYTE</a>,</div>
<div class="line">                               <a name="a35"></a><a class="code" href="msp430_8h.html#a1d80b08053e2c8dcad61e17d520da303">UCSSEL_2</a>, 1);</div>
<div class="line">  <span class="keywordflow">if</span> (NULL == m25p) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;M25P device initialization failed.\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  {</div>
<div class="line"><span class="preprocessor">#if (BSP430_MODULE_USCI5 - 0)</span></div>
<div class="line">    <span class="keyword">volatile</span> <a name="_a36"></a><a class="code" href="structsBSP430hplUSCI5.html">sBSP430hplUSCI5</a> * hpl = <a name="a37"></a><a class="code" href="serial___8h.html#aa44aa8cf921df3f68d0902526cc72e49">BSP430_SERIAL_HAL_GET_HPL_USCI5</a>(m25p-&gt;<a class="code" href="structsBSP430m25p.html#af3dd901691c0d55f8e385950129dea35">spi</a>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <span class="keywordtype">void</span> * hpl = NULL;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordtype">int</span> sm = -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (hpl) {</div>
<div class="line">      sm = 0;</div>
<div class="line">      <span class="keywordflow">if</span> (hpl-&gt;ctl0 &amp; <a name="a38"></a><a class="code" href="serial_8h.html#a84cdc2d11d71d5fd97b96f427c239cb9">BSP430_SERIAL_ADJUST_CTL0_INITIALIZER</a>(<a name="a39"></a><a class="code" href="msp430_8h.html#ab4313a6c37c97ba5cdba16c4ca56b517">UCCKPL</a>)) {</div>
<div class="line">        sm |= 0x02;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (! (hpl-&gt;ctl0 &amp; <a class="code" href="serial_8h.html#a84cdc2d11d71d5fd97b96f427c239cb9">BSP430_SERIAL_ADJUST_CTL0_INITIALIZER</a>(<a name="a40"></a><a class="code" href="msp430_8h.html#a51ab25e3e65cd1bb9863b0e6d0b7b6bd">UCCKPH</a>))) {</div>
<div class="line">        sm |= 0x01;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; sm) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Unable to extract SPI mode from %s\n&quot;</span>,</div>
<div class="line">              <a class="code" href="serial_8h.html#a7f2e6f39abd1faca343663917e34840a">xBSP430serialName</a>(<a class="code" href="m25p_8h.html#ad31f556b44c44325bcb36f1a62365901">BSP430_PLATFORM_M25P_SPI_PERIPH_HANDLE</a>));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%s initialized in SPI mode %u\n&quot;</span>, <a class="code" href="serial_8h.html#a7f2e6f39abd1faca343663917e34840a">xBSP430serialName</a>(<a class="code" href="m25p_8h.html#ad31f556b44c44325bcb36f1a62365901">BSP430_PLATFORM_M25P_SPI_PERIPH_HANDLE</a>), sm);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">volatile</span> <a name="_a41"></a><a class="code" href="structsBSP430hplPORT__8.html">sBSP430hplPORT</a> * pwr_hpl;</div>
<div class="line">    <span class="comment">/* Turn on power, then wait 10 ms for chip to stabilize before releasing RSTn. */</span></div>
<div class="line">    pwr_hpl = <a class="code" href="port_8h.html#af85295c41d6419afb9df641ae90d0213">xBSP430hplLookupPORT</a>(<a class="code" href="m25p_8h.html#ac59877ffa22ab02d6a10d63241909bd0">BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE</a>);</div>
<div class="line">    pwr_hpl-&gt;<a name="a42"></a>out &amp;= ~<a class="code" href="m25p_8h.html#a02937258e25a670e99f1ad3e5bdaf2ef">BSP430_PLATFORM_M25P_PWR_PORT_BIT</a>;</div>
<div class="line">    pwr_hpl-&gt;<a name="a43"></a>dir |= <a class="code" href="m25p_8h.html#a02937258e25a670e99f1ad3e5bdaf2ef">BSP430_PLATFORM_M25P_PWR_PORT_BIT</a>;</div>
<div class="line">    pwr_hpl-&gt;out |= <a class="code" href="m25p_8h.html#a02937258e25a670e99f1ad3e5bdaf2ef">BSP430_PLATFORM_M25P_PWR_PORT_BIT</a>;</div>
<div class="line">    <a class="code" href="core_8h.html#a3124959aa09ef7d745fb63c9ff5ee897">BSP430_CORE_DELAY_CYCLES</a>(10 * (<a class="code" href="clock_8h.html#a6ffd3f4fab35b64d0e8ff8d3179d69d9">BSP430_CLOCK_NOMINAL_MCLK_HZ</a> / 1000));</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_M25P_PWR_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">  <a name="a44"></a><a class="code" href="m25p_8h.html#a729d1eca221bc5a4ad31c8bffe8b6509">BSP430_M25P_RESET_CLEAR</a>(m25p);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Status register %d\n&quot;</span>, <a name="a45"></a><a class="code" href="m25p_8h.html#adaea56c95d7d1cdd5b6ba1aa6d1ede76">iBSP430m25pStatus_rh</a>(m25p));</div>
<div class="line">  rc = <a class="code" href="m25p_8h.html#a46ce5ccee68da4793921a40270d18256">iBSP430m25pStrobeCommand_rh</a>(m25p, <a class="code" href="m25p_8h.html#ae31b093e1d07520c8ee4a484ed3410a5">BSP430_M25P_CMD_WREN</a>);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;WREN got %d, status register %d\n&quot;</span>, rc, <a class="code" href="m25p_8h.html#adaea56c95d7d1cdd5b6ba1aa6d1ede76">iBSP430m25pStatus_rh</a>(m25p));</div>
<div class="line">  rc = <a class="code" href="m25p_8h.html#a46ce5ccee68da4793921a40270d18256">iBSP430m25pStrobeCommand_rh</a>(m25p, <a name="a46"></a><a class="code" href="m25p_8h.html#a0152d17bb2f06c6577b7cbdde10cafcf">BSP430_M25P_CMD_WRDI</a>);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;WRDI got %d, status register %d\n&quot;</span>, rc, <a class="code" href="m25p_8h.html#adaea56c95d7d1cdd5b6ba1aa6d1ede76">iBSP430m25pStatus_rh</a>(m25p));</div>
<div class="line"></div>
<div class="line">  rc = <a name="a47"></a><a class="code" href="m25p_8h.html#addadc38f5cf1fa5d6f70c923031f2af5">iBSP430m25pInitiateCommand_rh</a>(m25p, <a name="a48"></a><a class="code" href="m25p_8h.html#a5bbe622a1559ce5f9defd0fcd7489334">BSP430_M25P_CMD_RDID</a>);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    rc = <a class="code" href="m25p_8h.html#a22dde58e3aa1f17de5d0b1eea846fc01">iBSP430m25pCompleteTxRx_rh</a>(m25p, NULL, 0, 20, buffer);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a name="a49"></a><a class="code" href="core_8h.html#a954f39fe5652611f5a20f74289b0cfbf">BSP430_CORE_ENABLE_INTERRUPT</a>();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;READ_IDENTIFICATION got %d\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">if</span> (0 &lt;= rc) {</div>
<div class="line">    <a name="a50"></a><a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, 0);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Config identified %u sectors of %lu bytes each: %lu bytes total\n&quot;</span>,</div>
<div class="line">          <a name="a51"></a><a class="code" href="m25p_8h.html#a6f1bb11e03e040430ed5fbb7007b1d61">BSP430_PLATFORM_M25P_SECTOR_COUNT</a>,</div>
<div class="line">          (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a name="a52"></a><a class="code" href="m25p_8h.html#ab602f1d42789c783bc84c030b80da70c">BSP430_PLATFORM_M25P_SECTOR_SIZE</a>,</div>
<div class="line">          <a class="code" href="m25p_8h.html#a6f1bb11e03e040430ed5fbb7007b1d61">BSP430_PLATFORM_M25P_SECTOR_COUNT</a> * (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)BSP430_PLATFORM_M25P_SECTOR_SIZE);</div>
<div class="line"><span class="preprocessor">#if (BSP430_PLATFORM_M25P_SUBSECTOR_SIZE - 0)</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Config supports access as %u sub-sectors of %u bytes each\n&quot;</span>,</div>
<div class="line">          (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(<a class="code" href="m25p_8h.html#a6f1bb11e03e040430ed5fbb7007b1d61">BSP430_PLATFORM_M25P_SECTOR_COUNT</a> * (BSP430_PLATFORM_M25P_SECTOR_SIZE / <a name="a53"></a><a class="code" href="m25p_8h.html#ad0d4b761d1344f27d3bd8fae8006651c">BSP430_PLATFORM_M25P_SUBSECTOR_SIZE</a>)),</div>
<div class="line">          (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="m25p_8h.html#ad0d4b761d1344f27d3bd8fae8006651c">BSP430_PLATFORM_M25P_SUBSECTOR_SIZE</a>);</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* BSP430_PLATFORM_M25P_SUBSECTOR_SIZE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Config indicates device is not sub-sector addressable\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_M25P_SUBSECTOR_SIZE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;RDID identified %lu bytes total capacity\n&quot;</span>, 0x1UL &lt;&lt; buffer[2]);</div>
<div class="line"></div>
<div class="line">  addr = 0;</div>
<div class="line"></div>
<div class="line">  rc = readFromAddress(m25p, addr, <span class="keyword">sizeof</span>(flashContents));</div>
<div class="line">  <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(flashContents) != rc) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ERROR %d reading initial block\n&quot;</span>, rc);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, addr);</div>
<div class="line">    <span class="keywordflow">if</span> (0 == memcmp(flashContents, buffer, rc)) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Found expected contents.\n&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Did NOT find expected contents.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\nTest pattern (expected contents):&quot;</span>);</div>
<div class="line">  <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(flashContents, <span class="keyword">sizeof</span>(flashContents), 0);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (BSP430_PLATFORM_M25P_SUPPORTS_PE - 0)</span></div>
<div class="line">  rc = writeToAddress(m25p, <a name="a54"></a><a class="code" href="m25p_8h.html#a6e986550328e2b584886b2db931a362d">BSP430_M25P_CMD_PE</a>, addr, NULL, 0);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PAGE_ERASE got %d\n&quot;</span>, rc);</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* BSP430_PLATFORM_M25P_SUPPORTS_PE */</span><span class="preprocessor"></span></div>
<div class="line">  rc = writeToAddress(m25p, <a name="a55"></a><a class="code" href="m25p_8h.html#a080bcf61f01c9151072a3da826da18d0">BSP430_M25P_CMD_SE</a>, addr, NULL, 0);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;SECTOR_ERASE got %d\n&quot;</span>, rc);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_M25P_SUPPORTS_PE */</span><span class="preprocessor"></span></div>
<div class="line">  rc = readFromAddress(m25p, addr, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">  <span class="keywordflow">if</span> (0 &lt; rc) {</div>
<div class="line">    <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, addr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  rc = writeToAddress(m25p, <a name="a56"></a><a class="code" href="m25p_8h.html#a9df9ebd242643b85ff9653a95cc03f84">BSP430_M25P_CMD_PP</a>, addr, flashContents, <span class="keyword">sizeof</span>(flashContents));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PAGE_PROGRAM got %d\n&quot;</span>, rc);</div>
<div class="line">  rc = readFromAddress(m25p, addr, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">  <span class="keywordflow">if</span> (0 &lt; rc) {</div>
<div class="line">    <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, addr);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* PAGE PROGRAM is the one that only clears 1s to 0s so needs a</span></div>
<div class="line"><span class="comment">   * prior page or sector erase */</span></div>
<div class="line">  rc = writeToAddress(m25p, <a class="code" href="m25p_8h.html#a9df9ebd242643b85ff9653a95cc03f84">BSP430_M25P_CMD_PP</a>, addr, flashContents + 4, 4);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PAGE_PROGRAM to %lx returned %d\n&quot;</span>, addr, rc);</div>
<div class="line">  rc = readFromAddress(m25p, 0, <span class="keyword">sizeof</span>(flashContents));</div>
<div class="line">  <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, 0);</div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">  Write 4 took 8</span></div>
<div class="line"><span class="comment">  PAGE_PROGRAM to 0 returned 4</span></div>
<div class="line"><span class="comment">  00000000  88 11 03 30 cc 33 c3 3c  01 23 45 67 89 ab cd ef  ...0.3.&lt;.#Eg....</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">/* PAGE_WRITE is the one that does not need a prior erase cycle */</span></div>
<div class="line">  addr = 8;</div>
<div class="line"><span class="preprocessor">#if (BSP430_PLATFORM_M25P_SUPPORTS_PW - 0)</span></div>
<div class="line">  rc = writeToAddress(m25p, <a name="a57"></a><a class="code" href="m25p_8h.html#a34ecbb64d884daa2970f1d7372f14a68">BSP430_M25P_CMD_PW</a>, addr, flashContents + 4, 4);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PAGE_WRITE to %lx returned %d\n&quot;</span>, addr, rc);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  rc = writeToAddress(m25p, <a class="code" href="m25p_8h.html#a9df9ebd242643b85ff9653a95cc03f84">BSP430_M25P_CMD_PP</a>, addr, flashContents + 4, 4);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;overwrite PAGE_PROGRAM to unerased %lx returned %d\n&quot;</span>, addr, rc);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  rc = readFromAddress(m25p, 0, <span class="keyword">sizeof</span>(flashContents));</div>
<div class="line">  <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, 0);</div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">  Write 4 took 204</span></div>
<div class="line"><span class="comment">  PAGE_WRITE to 8 returned 4</span></div>
<div class="line"><span class="comment">  00000000  88 11 03 30 cc 33 c3 3c  cc 33 c3 3c 89 ab cd ef  ...0.3.&lt;.3.&lt;....</span></div>
<div class="line"><span class="comment">  */</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Initiating bulk erase...&quot;</span>);</div>
<div class="line">  t0 = t1 = 0;</div>
<div class="line">  rc = <a class="code" href="m25p_8h.html#a46ce5ccee68da4793921a40270d18256">iBSP430m25pStrobeCommand_rh</a>(m25p, <a class="code" href="m25p_8h.html#ae31b093e1d07520c8ee4a484ed3410a5">BSP430_M25P_CMD_WREN</a>);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    rc = <a class="code" href="m25p_8h.html#a46ce5ccee68da4793921a40270d18256">iBSP430m25pStrobeCommand_rh</a>(m25p, <a name="a58"></a><a class="code" href="m25p_8h.html#aedeb9630f939178733cb92e24cac6139">BSP430_M25P_CMD_BE</a>);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    <span class="keywordtype">int</span> sr;</div>
<div class="line"></div>
<div class="line">    t0 = <a class="code" href="uptime_8h.html#a7e0b8aeba63d7b2ce965a650125eb8ef">ulBSP430uptime</a>();</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">      sr = <a class="code" href="m25p_8h.html#adaea56c95d7d1cdd5b6ba1aa6d1ede76">iBSP430m25pStatus_rh</a>(m25p);</div>
<div class="line">    } <span class="keywordflow">while</span> ((0 &lt;= sr) &amp;&amp; (<a class="code" href="m25p_8h.html#ab7d0f64136a76d1e261d09d8c7bebb78">BSP430_M25P_SR_WIP</a> &amp; sr));</div>
<div class="line">    t1 = <a class="code" href="uptime_8h.html#a7e0b8aeba63d7b2ce965a650125eb8ef">ulBSP430uptime</a>();</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\nBULK_ERASE got %d\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    <span class="keywordtype">char</span> tstr[<a name="a59"></a><a class="code" href="uptime_8h.html#ae47d677ac9443e2e26608ef5278f1a6d">BSP430_UPTIME_AS_TEXT_LENGTH</a>];</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Bulk erase took %lu utt = %s\n&quot;</span>, t1-t0, <a name="a60"></a><a class="code" href="uptime_8h.html#a1cb1310c769f028347010502456fb918">xBSP430uptimeAsText</a>(t1 - t0, tstr));</div>
<div class="line">  }</div>
<div class="line">  rc = readFromAddress(m25p, 0, <span class="keyword">sizeof</span>(flashContents));</div>
<div class="line">  <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, 0);</div>
<div class="line"></div>
<div class="line">  rc = writeToAddress(m25p, <a class="code" href="m25p_8h.html#a9df9ebd242643b85ff9653a95cc03f84">BSP430_M25P_CMD_PP</a>, 0, flashContents, <span class="keyword">sizeof</span>(flashContents));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Restore got %d\n&quot;</span>, rc);</div>
<div class="line"></div>
<div class="line">  addr = 0;</div>
<div class="line">  <span class="keywordflow">while</span> (addr &lt; (256 * 1025L)) {</div>
<div class="line">    rc = readFromAddress(m25p, addr, <span class="keyword">sizeof</span>(buffer));</div>
<div class="line">    <span class="keywordflow">if</span> (0 &gt; rc) {</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="console_8h.html#afd126d6b4a6180ae3de71c17a52357c0">vBSP430consoleDisplayMemory</a>(buffer, rc, addr);</div>
<div class="line">    addr += rc;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Nov 15 2014 11:27:13 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
